# BPNet Docker Container

This repository contains a Dockerfile for building a container with the [BPNet](https://github.com/computational-biology/bpnet) and [MetBP](https://github.com/computational-biology/metbp) tools wrapped in the CLI2REST API.

## What is BPNet?

BPNet is software for computing base pair networks found in DNA/RNA. The software also calculates the overlap based network computations. It was developed by the computational biology team and can analyze nucleic acid structures to identify base pair interactions and network properties.

## What is MetBP?

MetBP is a standalone command-line tool for detection and analysis of metal-ion and base pair interactions. It detects and analyzes metal interactions with RNA (and DNA) base pairs from crystal structure files stored in mmCIF or PDB format. The program provides results in plain text as well as machine-readable JSON and CSV formats.

## Usage

### Using the `cli2rest-bio` Tool

The recommended way to use this container is with the `cli2rest-bio` command-line tool provided in the main repository:

```bash
# Process mmCIF files with BPNet
cli2rest-bio bpnet/config-cif.yaml your_structure.cif
cli2rest-bio bpnet/config-cif.yaml *.cif

# Process PDB files with BPNet
cli2rest-bio bpnet/config-pdb.yaml your_structure.pdb
cli2rest-bio bpnet/config-pdb.yaml *.pdb

# Process mixed file types
cli2rest-bio bpnet/config-cif.yaml structure1.cif
cli2rest-bio bpnet/config-pdb.yaml structure2.pdb
```

This tool handles starting the container, sending requests according to the appropriate configuration file, saving outputs (stdout/stderr prefixed with `bpnet-`), and cleaning up. See the main [README.md](../README.md) for more details on `cli2rest-bio`.

## Building the Container

To build the container, run:

```bash
docker build -t cli2rest-bpnet .
```

## Running the Container

To start the container and expose the CLI2REST API on port 8000:

```bash
docker run -p 8000:8000 cli2rest-bpnet
```

## Using the CLI2REST API

The CLI2REST API allows you to run the BPNet tool via HTTP requests. Here's how to use it:

### Example: Analyzing base pair networks using the API directly

You can use cURL with form data to send a request:

```bash
# For mmCIF files (corresponds to bpnet/config-cif.yaml)
curl -X POST http://localhost:8000/run-command \
  -F 'arguments=wrapper.sh' \
  -F 'arguments=input.cif' \
  -F 'input_files=@path/to/your_local_structure.cif;filename=input.cif'

# For PDB files (corresponds to bpnet/config-pdb.yaml)
curl -X POST http://localhost:8000/run-command \
  -F 'arguments=wrapper.sh' \
  -F 'arguments=input.pdb' \
  -F 'input_files=@path/to/your_local_structure.pdb;filename=input.pdb'
```

### Response

The API will return a JSON response containing the standard output, standard error, exit code, and the specific output files generated by the wrapper.

Example response:

```json
{
  "exit_code": 0,
  "stdout": "Running BPNet on input.cif...\nRunning MetBP on input.cif...\nAnalysis complete. Output files:\n  input_basepair.json (from MetBP)\n  input.rob (from BPNet)",
  "stderr": "",
  "output_files": [
    {
      "filename": "input_basepair.json",
      "content": "base64_encoded_content"
    },
    {
      "filename": "input.rob",
      "content": "base64_encoded_content"
    }
  ]
}
```

## BPNet Output Files

BPNet generates multiple output files for analysis:

- `xxxx_rna.pdb` - RNA part only in PDB format
- `xxxx.out` - All base-pair information
- `xxxx.adj` - Adjacency information
- `xxxx.fasta` - Nucleic acid primary sequence in FASTA format
- `xxxx.dbn` - Base pair information in dot-bracket notation
- `xxxx.bpseq` - Base pair information in bpseq notation
- `xxxx.dat` - Secondary structure information
- `xxxx.hlx` - Helix, loop and pseudo helix information
- `xxxx_rna.pml` - PyMOL visualization script for RNA
- `xxxx_cif.pml` - PyMOL visualization script for entire structure
- `xxxx.ps` - PostScript file showing contact-map distribution
- `xxxx_helix.pml` - PyMOL script for helix visualization
- `xxxx.html` - VARNA-compatible applet for secondary structure visualization

## BPNet Options

BPNet supports various command-line options:

### General Options
- `--help` - Show help
- `--version` - Print version
- `-nettype=[basepair/contact]` - Network type (default: contact)
- `-netsize=from-to` or `-netsize=size` - Network size filter
- `-exdeg=number` - Networks with at least one vertex of specified degree
- `-cycles=number` - Networks with at least specified number of cycles
- `-wttype=[c1p-c1p]` - Weight type (default: E-val for base pairs, surface overlap for contacts)
- `-wtcutoff=value` - Contact cutoff value
- `-chain=name` - Analyze specific chain only

### Base Pair Options
- `-hbdist=value` - Hydrogen bond distance cutoff (default: 3.8Ã…)
- `-sugmed=[true/false]` - Include sugar-mediated base pairs (default: true)
- `-chmed=[true/false]` - Include C-H...O/N mediated H-bonds (default: true)
- `-hetatm=[true/false]` - Include modified nucleobases (default: true)

For a complete list of options, see the [BPNet documentation](https://github.com/computational-biology/bpnet).

## Input Formats

Both BPNet and MetBP accept mmCIF and PDB file formats.

## MetBP Usage

MetBP is also included in this container for analyzing metal-ion and base pair interactions. It can be used via the CLI2REST API by creating appropriate configuration files. MetBP generates various output files including:

- `.sum` - Summary file with structure statistics
- `.met` - Main output file with metal and base pair interaction details
- `.det` - Detailed metal binding site information
- `.pml` - PyMOL visualization script
- `_metbp.json` - Metal-base pair interactions in JSON format

MetBP supports various command-line options for customizing analysis, including hydrogen bond distance cutoffs, chain-specific analysis, and different analysis modes (bp/nuc/all/dev).

For detailed MetBP documentation, see the [MetBP repository](https://github.com/computational-biology/metbp).
